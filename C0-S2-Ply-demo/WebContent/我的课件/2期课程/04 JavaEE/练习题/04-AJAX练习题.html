<!DOCTYPE html>
<html style="height: 100%">
<head>
<meta charset="UTF-8">
<title>练习题</title>
<script src="https://cdn.bootcss.com/jquery/3.5.0/jquery.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.11/vue.js"></script>

<script type="text/javascript">
function a(){
	if(event.altKey  && event.ctrlKey/* && event.shiftKey */){
		var e = event.srcElement;
		var answer = e.getAttribute("answer");
		if(answer){
			e.value = answer;
		}
		event.stopPropagation();
		return;
	}
}
function Q(content, expect){
	this.content = content;
	this.expect = expect;
	this.result = false;
	this.resultText = null;
	this.test = function(){
		var script = this.content;
		var inputs = findDD(event.srcElement).querySelectorAll("input");
		var allright = true
		for( var input of inputs){
			if(input.value){
				script = script.replace(/<input.+?>/, input.value);
				if( ! this.expect){
					var ok = input.value == input.getAttribute('answer');
					var regex = input.getAttribute("regex");
					if(ok == false && regex){
						regex = new RegExp("^"+regex+"$");
						ok = regex.test(input.value);
					}
					if(ok){
						input.classList.remove("cuo");
						input.classList.add("dui");
					} else {
						input.classList.remove("dui");
						input.classList.add("cuo");
						allright = false;
					}
				}
			} else {
				allright = false;
			}
		}
		this.result = allright;
		if(this.expect != undefined){
			try{
				script = script.replace(/<.+?>[^<]+?<\/.+?>/g, "");
				script = script.replace(/<.+?>/g, "");
				script = script.replace(/&amp;/g, "&");
				console.info("========开始测试========");
				console.log(script);
				var ret = eval(script);
				this.resultText = ret ? ret.toString() : "";
				if(new RegExp("^\/.+\/$").test(this.expect)){
					var reg = eval(this.expect);
					this.result = reg.test(this.resultText);
				} else {
					this.result = this.expect == this.resultText;
				}
			} catch (e) {
				console.error(e);
				this.result = false;
			}
		}
	}
}

</script>
</head>
<body>
	<div id="main">
		<fieldset class="alist">
			<legend>JS基础API练习题 答题结果</legend>
			<span class="res" v-for="q,i in questions">
				题{{i+1}}: <b style="color: red">{{q.result?'对':''}}</b>
			</span>
		</fieldset>
		<fieldset>
			<legend>题目: 请按照要求再横线处填写代码 <a target="_blank" href="http://c.biancheng.net/js/ajax/"><b>Ajax入门教程</b></a> </legend>
			<div class="qlist">
			<dl v-for="q,i in questions" :style="{backgroundColor:q.result?'#ddd':'#eee'}">
				<dt>第{{i+1}}题 <b style="color: red;">{{q.result?'对':''}}</b>
					<button @click="q.test()">提交答案</button><br>
				</dt>
				<dd @click="a(q)">
					<pre v-html="q.content"></pre>
				</dd>
				<dd v-if="q.expect">
					正确的结果: <span>{{q.expect}}</span><br>
					你写的结果: <span>{{q.resultText}}</span>
				</dd>
			</dl>
			</div>
		</fieldset>
	</div>
	<div style="display: none;">
	
<!--$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$-->

<pre>
<h4>什么是 AJAX ？</h4>
AJAX = <input size=1 answer="异步"> JavaScript 和 <input size=1 answer="XML"> ( Asynchronous JavaScript and XML )。
AJAX 是一种用于创建快速动态网页的技术。
通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。
传统的网页（不使用 AJAX）如果需要更新内容，必需重载整个网页面。
有很多使用 AJAX 的应用程序案例：新浪微博、Google 地图、开心网等等。

<h4>同步 or 异步?</h4>
<input size=1 answer="同步"> 指的是: 一个任务执行完成之后才能进行下一个任务
<input size=1 answer="异步"> 指的是: 多个任务可以同时进行
</pre>

<pre>
<h4>XMLHttpRequest ？</h4>
在 AJAX 中使用 <input answer="XMLHttpRequest"> 对象用于和服务器交换数据。
所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。
创建 XMLHttpRequest 对象的语法：
var xhr = <input size=40 answer="new XMLHttpRequest()">;
老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：
var xhr = <input size=40 answer='new ActiveXObject("Microsoft.XMLHTTP")'>;
</pre>

<pre>
<h4>关于 XMLHttpRequest 的方法</h4>
通过AJAX向服务器发送请求 , 如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 
<input size=3 answer="open">()方法和 <input size=3 answer="send">()方法( 请按调用顺序填写 )：
<table border=1>
<tbody><tr><th>方法</th><th>描述</th></tr>
<tr>
<td> open ( <i>method</i> , <i>url</i> , <i>async</i> )</td>
<td>	该方法用于设置请求的类型、URL 以及是否异步处理请求。请填写参数名
	<input size=5 answer="method">：请求的类型；GET 或 POST
	<input size=5 answer="url">：文件在服务器上的位置
	<input size=5 answer="async">：true（异步）或 false（同步）, 注意: 默认为 true
</tr>
<tr>
<td> send ( <i>data</i> )</td>
<td>	该方法用于将请求发送到服务器。请填写参数名
	<input size=5 answer="data">：仅用于 POST 请求, 设置提交的数据
</td>
</tr>
<tr>
<td> setRequestHeader ( <i>header</i> , <i>value</i> )</td>
<td>	向请求添加 HTTP 头
	<input size=5 answer="header">: 设置头的名称
	<input size=5 answer="value">: 设置头的值
</td>
</tr>
</tbody></table></pre>

<pre expect="">
// 请按照要求完成 AJAX 调用
var xhr = null;
if(XMLHttpRequest){
	// 创建 XMLHttpRequest 对象
	xhr = <input size=40 answer="new XMLHttpRequest()">;
} else {
	// 创建 老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象
	xhr = <input size=40 answer='new ActiveXObject("Microsoft.XMLHTTP")'>;
}
// 设置响应事件的回调函数
xhr.<input answer='onreadystatechange'> = function(){
	// 判断发送状态是否等于4  并且  响应结果码是否等于200
	if(<input answer='xhr.readyState==4'> &amp;&amp; <input answer='xhr.status==200'>){
		// 将服务器返回的文本数据 alert 出来
		<input answer='alert(xhr.responseText)'>;
	}
}
// 设置请求 , 方法名为 GET , 访问地址为  http://47.106.66.89:1112/hello.s, 只传 2 个参数完成调用
<input size=50 answer='xhr.open("GET","http://47.106.66.89:1112/hello.s")'>;
// 发送请求
<input answer='xhr.send()'>;
alert("OK 大功告成! ");
/* 最后的测试: 关于同步和异步
	请在设置请求的 open 方法中加入第三个参数, 并观察 alert 信息的变化
*/
</pre>

<pre>
<h4>关于 XMLHttpRequest 的属性</h4>
获得来自服务器的响应，请使用 XMLHttpRequest 对象的以下两个属性:
<input answer='responseText'> , 获得字符串形式的响应数据。
<input answer='responseXML'> , 获得 XML 形式的响应数据。对于该对象的具体操作, 请参考 document 对象
当请求被发送到服务器时，我们需要执行一些基于响应的任务。下面是 XMLHttpRequest 对象的三个重要的属性：
<table border=1>
<tbody><tr>
<th>属性</th>
<th>描述</th>
</tr>
<tr>
<td><input answer='onreadystatechange'></td>
<td>	存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</td>
</tr>
<tr>
<td><input answer='readyState'></td>
<td>	存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。
	<input size=1 answer='0'>: 表示请求未初始化
	<input size=1 answer='1'>: 表示服务器连接已建立
	<input size=1 answer='2'>: 表示请求已接收
	<input size=1 answer='3'>: 表示请求处理中
	<input size=1 answer='4'>: 表示请求已完成，且响应已就绪
</td>
</tr>
<tr>
<td><input answer='status'></td>
<td>	<input size=1 answer='200'>: 表示"OK"
	<input size=1 answer='404'>: 表示未找到页面
	<input size=1 answer='500'>: 表示服务器内部
</tr>
</tbody></table></pre>

<pre expect="">
// 请按照要求完成 AJAX 调用
var xhr = null;
if(XMLHttpRequest){
	xhr = new XMLHttpRequest();
} else {
	xhr = new ActiveXObject("Microsoft.XMLHTTP");
}
xhr.onreadystatechange = function(){
	if(xhr.readyState==4 &amp;&amp; xhr.status==200){
		alert(xhr.responseText);
	}
}
// 设置请求 , 方法名为 POST , 访问地址为  http://47.106.66.89:1112/add.do
<input size=75 answer='xhr.open("POST","http://47.106.66.89:1112/add.do")'>;
// 设置请求头属性, 设置 Content-type 为 application/x-www-form-urlencoded
// 注意 : POST 请求必须设置该参数, 并且还必须是在 open 方法执行之后才能设置
<input size=75 answer='xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")'>;
// 发送请求 , 添加两个数字参数, 参数名分别是 num1 和 num2
<input size=75 answer='xhr.send("num1=10&num2=20")' regex='xhr\.send\("num[12]=\d+&num[12]=\d+"\)'>;
</pre>

<!--$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$-->

	</div>
</body>
<script type="text/javascript">
var pres = document.querySelectorAll("div>pre");
var qs = [];
for(var pre of pres){
	qs.push(new Q(pre.innerHTML,pre.getAttribute("expect")));
}
function findDD(node){
	if(node && node.nodeName.toLowerCase() == 'dl'){
		return node;
	} else {
		return findDD(node.parentNode);
	}
}
new Vue({
	el : "#main",
	data : {
		questions : qs
	},
	methods : {
		a(q){
			if(event.altKey  && event.ctrlKey/* && event.shiftKey */){
				var dd = findDD(event.srcElement);
				var inputs = dd.querySelectorAll("input");
				for( var input of inputs){
					var answer = input.getAttribute("answer");
					if(answer){
						input.value = answer;
					}
				}
				q.test();
			}
		}
	},
	mounted : function(){
		document.querySelectorAll("pre input").forEach(o=>o.onclick=a);
		document.querySelectorAll("a").forEach(o=>o.target="_blank");
	}
});
</script>
<style type="text/css">
a{
	text-decoration: none;
}
a:hover{
	text-decoration: underline;
}
body{
	padding: 10px
}
.res{
	display: inline-block;
	margin : 0px 5px;
	width: 60px;
	height: 20px;
	line-height:20px;
}
textarea,input {
	color:blue;
	font-size: 1.1em;
	font-weight : bold;
	margin: 2px;
	padding: 0px 20px 0px 2px;
}
.qlist dl{
	padding: 5px;
	border: 1px solid #ccc;
	background: #eee;
	border-radius: 5px;
}
.qlist dl dt{
	padding: 5px 20px;
}
.qlist dl:hover{
	border-color: blue;
}
.qlist{
	overflow: auto; 
}
pre{
	vertical-align: middle;
	font-family: 微软雅黑;
	overflow: auto;
	padding-right:20px;
	white-space:pre-wrap; /* css3.0 */ 
	white-space:-moz-pre-wrap; /* Firefox */ 
	white-space:-pre-wrap; /* Opera 4-6 */ 
	white-space:-o-pre-wrap; /* Opera 7 */ 
	word-wrap:break-word; /* Internet Explorer 5.5+ */ 
}
button{
	font-size: 1.1em;
	padding: 5px 20px;
	float: right
}
b{
	color:#f0f
}
.dui{
	background: #fff url(images/dui.jpg) no-repeat right center;
	color : green;
}
.cuo{
	background: #fff url(images/cuo.jpg) no-repeat right center;
	color : #888;
}
pre h1, pre h2,pre h3, pre h4,pre h5, pre h6{
	margin: 0px
}
pre h3{
	color:red
}
pre table {
	width:100%;
}
</style>
</html>