<!DOCTYPE html>
<html style="height: 100%">
<head>
<meta charset="UTF-8">
<title>JS数组练习</title>
<script src="https://cdn.bootcss.com/jquery/3.5.0/jquery.js"></script>
<script src="https://cdn.bootcss.com/vue/2.6.11/vue.js"></script>
<style type="text/css">
body{
	padding: 10px
}
.res{
	display: inline-block;
	margin : 0px 5px;
	width: 60px;
	height: 20px;
	line-height:20px;
}
textarea,input {
	color:blue;
	font-size: 1.1em;
	font-weight : bold;
	width:50%;
	margin: 2px;
	padding: 0px 2px
}
.qlist dl{
	padding: 5px;
	border: 1px solid #ccc;
	background: #eee;
	border-radius: 5px;
}
.qlist dl:hover{
	border-color: blue;
}
.qlist{
	overflow: auto; 
}
pre *{
	vertical-align: middle;
	font-family: 微软雅黑;
}
</style>
<script type="text/javascript">
function Q(content, expect, validate, answer){
	this.content = content;
	this.validate = cast(validate);
	this.expect = cast(expect);
	this.answer = answer;
	this.result = false;
	this.resText = null;
	function cast(value){
		if(value){
			if(typeof(value) == 'string'){
				try{
					return eval(value);
				} catch (e) {
					console.error(e);
					return null;
				}
			} else {
				return value;
			}
		} else {
			return null;
		}
	}
}

</script>
</head>
<body>
	<div id="main">
		<fieldset class="alist">
			<legend>JS数组练习题 答题结果</legend>
			<span class="res" v-for="q,i in questions">
				题{{i+1}}: <b style="color: red">{{q.result?'对':''}}</b>
			</span>
		</fieldset>
		<fieldset>
			<legend>题目: 请按照要求再横线处填写代码, 浏览器控制台会打印每道题的返回结果</legend>
			<div class="qlist">
			<dl v-for="q,i in questions" :style="{backgroundColor:q.result?'#ddd':'#eee'}">
				<dt>第{{i+1}}题 <b style="color: red">{{q.result?'对':''}}</b></dt>
				<dd @click="a(q)">
					<pre><span v-html="prefix( q.content )"></span><textarea v-if='(q.content.indexOf("答题线"))>-1' @change="test( q, $event )" placeholder="请填写JS代码(可以写多行)"></textarea><span v-html="suffix( q.content )"></span></pre>
					<button v-if='(q.content.indexOf("答题线"))==-1' @click="test( q, $event )">提交答案</button><br>
					正确结果: <span v-html="q.expect != undefined ? q.expect : ''" :style="showResult(q)"></span><br>
					你的结果: <span v-html="q.resText" :style="showResult(q)"></span>
				</dd>
			</dl>
			</div>
		</fieldset>
	</div>
	<div style="display: none;">
<pre expect='[ "林冲", "武松", 5 ]'>
var heroes = ["武松","李逵","华荣","燕青","时迁","晁盖","林冲"];
var result = []; // 测试结果
result[0] = <input placeholder="填写代码" answer="heroes.pop()">; // 移除元素
result[1] = <input placeholder="填写代码" answer="heroes.shift()">; // 移除元素
result[2] = <input placeholder="填写代码" answer="heroes.length">; // 获取数组长度
result; // 输出结果
</pre>

<pre expect='[ "朱仝", "武松", "周通" ]'>
var heroes = ["武松"];
<input placeholder="填写代码" answer="heroes.push('周通')">; // 添加元素
<input placeholder="填写代码" answer="heroes.unshift('朱仝')">; // 添加元素
<input placeholder="填写代码" answer="heroes.length">; // 获取数组长度
heroes; // 输出结果
</pre>

	
<pre expect="['林冲','武松','李逵','晁盖',3]">
var heroes = ["武松","李逵","华荣","燕青","时迁","晁盖","林冲"];
var result = []; // 测试结果
result[0] = <input placeholder="填写代码" answer="heroes.pop()">; // 移除元素
result[1] = <input placeholder="填写代码" answer="heroes.shift()">; // 移除元素
result[2] = <input placeholder="填写代码" answer="heroes.shift()">; // 移除元素
result[3] = <input placeholder="填写代码" answer="heroes.pop()">; // 移除元素
result[4] = <input placeholder="填写代码" answer="heroes.length">; // 获取数组长度
result; // 输出结果
</pre>

<pre expect='[ "朱仝", "雷横", "武松", "周通", "董平" ]'>
var heroes = ["武松"];
<input placeholder="填写代码" answer="heroes.push('周通')">; // 添加元素
<input placeholder="填写代码" answer="heroes.push('董平')">; // 添加元素
<input placeholder="填写代码" answer="heroes.unshift('雷横')">; // 添加元素
<input placeholder="填写代码" answer="heroes.unshift('朱仝')">; // 添加元素
<input placeholder="填写代码" answer="heroes.length">; // 获取数组长度
heroes; // 输出结果
</pre>

<pre expect='[ "武松", "周通", "董平", "白胜" ]'>
var heroes1 = ["武松","周通"];
var heroes2 = ["董平","白胜"];
var result = []; // 测试结果
result = <input placeholder="填写代码" answer="heroes1.concat(heroes2)">; // 合并数组
result; // 输出结果
</pre>

<pre expect='[ "公孙胜", "张青", "鲁达", "林冲" ]'>
var heroes1 = ["鲁达","林冲"];
var heroes2 = ["公孙胜","张青"];
var result = []; // 测试结果
result = <input placeholder="填写代码" answer="heroes2.concat(heroes1)">; // 合并数组
result; // 输出结果
</pre>

	</div>
</body>
<script type="text/javascript">
var pres = document.querySelectorAll("div>pre");
var qs = [];
for(var pre of pres){
	var q = new Q(pre.innerHTML
			,pre.getAttribute("expect")
			,pre.getAttribute("validate")
			,pre.getAttribute("answer"));
	qs.push(q);
}

new Vue({
	el : "#main",
	data : {
		questions : qs
	},
	methods : {
		test(q,event){
			var value = event.srcElement.value;
			if(value && q.validate){
				if( ! q.validate.expr.test(value)) {
					alert(q.validate.msg);
					q.result = false;
					return;
				}
			}
			var script = q.content;
			if(value){
				script = script.replace(/答题线/g,value);
			} else {
				var inputs = event.srcElement.parentNode.querySelectorAll("input");
				for( var input of inputs){
					script = script.replace(/<input.+?>/, input.value);
				}
			}
			try{
				console.info("====测试开始====");
				console.info(script);
				q.resText = eval(script);
				console.info("====测试结束====");
				q.result = q.expect != undefined ? q.resText.toString() == q.expect.toString() : true;
			}catch(e){
				alert(e.message);
				console.error(e);
				q.resText = null;
				q.result = false;
			}
		},
		prefix(text){
			return text.indexOf('答题线') > -1 ? text.substring(0, text.indexOf('答题线')) : text;
		},
		suffix(text){
			return text.indexOf('答题线') > -1 ? (text.substring(text.indexOf('答题线') + 3)) : "";
		},
		showResult(q){
			return {color:q.result?'green':'inherit',
					fontWeight:q.result?'bold':'inherit'}
		},
		a(q){
			if(event.altKey){
				if(q.answer){
					event.srcElement.value = q.answer;
				}
				var inputs = event.srcElement.parentNode.querySelectorAll("input");
				for( var input of inputs){
					var answer = input.getAttribute("answer");
					if(answer){
						input.value = answer;
					}
				}
				this.$options.methods.test(q,event);
			}
		}
	},
	
});
</script>
</html>